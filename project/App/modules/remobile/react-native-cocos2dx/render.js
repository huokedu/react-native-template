module.exports=(res, params)=>{var GameOver=cc.Layer.extend({ctor:function(){this._super();var e=cc.director.getWinSize(),t=new cc.LayerColor(cc.color(125,125,125,125));t.ignoreAnchor=!1,t.anchorX=.5,t.anchorY=.5,t.setContentSize(e.width,e.height),t.x=e.width/2,t.y=e.height/2,this.addChild(t);var c=new cc.MenuItemSprite(new cc.Sprite(res.img.main_restart),new cc.Sprite(res.img.main_restart),this.onRestart,this),i=new cc.MenuItemSprite(new cc.Sprite(res.img.main_home),new cc.Sprite(res.img.main_home),this.onHome,this),n=new cc.Menu(c);n.setPosition(e.width/2-100,e.height/2-100),this.addChild(n);var r=new cc.Menu(i);return r.setPosition(e.width/2+100,e.height/2-100),this.addChild(r),!0},onRestart:function(){this.removeFromParent(!0);var e=new cc.Scene,t=new GameViewBackground;e.addChild(t,-1,0);var c=new GameView;e.addChild(c,-1,0),cc.director.runScene(e),t.scoreBg(),c.startGame()},onHome:function(){this.removeFromParent(!0),cc.director.runScene(new MenuViewScene)}}),bgSize=null,person=null,sbSize=null,guideTextPic=null,npcNormal=null,ScoreText,score,gameViewXOffset=0,preBlackXOffset=0,stickObject=null,GameLayer=cc.Layer.extend({ctor:function(){this._super()}}),getAnimate=function(e,t,c){for(var i,n=[],r="",s=cc.spriteFrameCache,a=1;a<t;a++)r=e+a+".png",i=s.getSpriteFrame(r),n.push(i);var o=new cc.Animation(n,c);return cc.animate(o)},personControl={initRes:function(e){var t=cc.spriteFrameCache;t.addSpriteFrames(res.plist.main_shake,res.img.main_shake),t.addSpriteFrames(res.plist.main_kick,res.img.main_kick),t.addSpriteFrames(res.plist.main_walk,res.img.main_walk),t.addSpriteFrames(res.plist.main_yao,res.img.main_yao),person=new cc.Sprite("#d0001.png");var c=person.getContentSize();person.x=bgSize.width/2,person.y=sbSize.height+c.height/2,e.addChild(person)},yao:function(){var e=getAnimate("d000",10,.1);person.stopAllActions(),person.runAction(e.repeatForever())},walk:function(e){var t=getAnimate("z000",10,e);person.stopAllActions(),person.runAction(t.repeatForever())},shake:function(){var e=getAnimate("dq000",10,.1);person.stopAllActions(),person.runAction(e.repeatForever())}},GameViewBackground=cc.Layer.extend({ctor:function(){this._super(),bgSize=cc.winSize;var e,t=parseInt(3*cc.random0To1());switch(t){case 0:e=res.img.main_background0;break;case 1:e=res.img.main_background1;break;case 2:e=res.img.main_background2;break;case 3:e=res.img.main_background3;break;default:e=res.img.main_background0}var c=new cc.Sprite(e);c.setPosition(bgSize.width/2,bgSize.height/2),this.addChild(c,-1)},scoreBg:function(){var e=cc.winSize,t=new cc.Sprite(res.img.main_score_bg);t.x=e.width/2,t.y=e.height/2+300,this.addChild(t,1),ScoreText=new cc.LabelTTF("","宋体",46),ScoreText.setPosition(cc.p(e.width/2,e.height/2+300)),ScoreText.setColor(cc.color(255,255,255)),this.addChild(ScoreText,2)},drawGuideText:function(){guideTextPic=new cc.Sprite(res.img.main_guide_text),guideTextPic.setPosition(bgSize.width/2,bgSize.height/2+220),this.addChild(guideTextPic,2),guideTextPic.setVisible(!1)}}),GameView=cc.Layer.extend({self:null,_start:!1,ctor:function(){this._super();var e=new cc.Sprite(res.img.main_stick_black);sbSize=e.getContentSize(),e.setScale(180/sbSize.width,387/sbSize.height),e.x=bgSize.width/2,e.y=sbSize.height/2-50,this.addChild(e),self=this,personControl.initRes(this),personControl.yao(),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchEnded:this.onTouchEnded},this)},startGame:function(){score=0,ScoreText.setString(score);gameViewXOffset=-90+bgSize.width/2,preBlackXOffset=180,this.runAction(cc.sequence(cc.moveBy(.2,cc.p(-gameViewXOffset,100)))),personControl.walk(.1),person.runAction(cc.sequence(cc.moveBy(.2,cc.p(62,0)),cc.callFunc(this.personYao,this),cc.callFunc(this.addBlock,this))),null!=guideTextPic&&guideTextPic.setVisible(!0)},addBlock:function(){self._start=!0,stickObject=new cc.Sprite(res.img.main_stick_black),stickObject.setAnchorPoint(cc.p(.5,0));stickObject.getContentSize();stickObject.setPosition(gameViewXOffset+preBlackXOffset-2.5,sbSize.height),stickObject.setScaleY(0),this.addChild(stickObject);var e=120*cc.random0To1()+10,t=new cc.Sprite(res.img.main_stick_black);t.getContentSize();t.setScale(e/sbSize.width,387/sbSize.height),t.x=gameViewXOffset+bgSize.width+e/2,t.y=-100,t.setAnchorPoint(.5,0),this.addChild(t);var c=bgSize.width-preBlackXOffset,i=(cc.random0To1()+.6)/2;currBlackXOffset=e,betweenXOffset=i*c,t.runAction(cc.sequence(cc.moveBy(.05,cc.p(-betweenXOffset,0))))},personYao:function(){personControl.yao()},onTouchBegan:function(e,t){return cc.log("touch begin"),!!self._start&&(self.startSchedule(),!0)},onTouchEnded:function(e,t){self.stopSchedule()},startSchedule:function(){self.schedule(this.upDateBlack,.02),personControl.shake()},stopSchedule:function(){this.unschedule(this.upDateBlack),self._start=!1,stickObject.runAction(cc.sequence(cc.delayTime(.3),cc.rotateBy(.1,90),cc.callFunc(this.rotateEnd,this)))},upDateBlack:function(){var e=stickObject.getScaleY();stickObject.setScaleY(e+.07)},rotateEnd:function(){var e=stickObject.getContentSize(),t=stickObject.getScaleY()*e.height,c=betweenXOffset+preBlackXOffset,i=bgSize.width-c;i+5<=t&&i+currBlackXOffset>=t?(cc.log("fuck ok"),this.next(i+currBlackXOffset)):i+currBlackXOffset<t?this.gameOver(i+currBlackXOffset+50):this.gameOver(t+30)},gameOver:function(e){cc.log("over.....");var t=e/500;this.npcRun(t/30),person.runAction(cc.sequence(cc.moveBy(t,cc.p(e,0)),cc.callFunc(this.gameFaile,this)))},npcRun:function(e){personControl.walk(e)},nextBlack:function(){score++,ScoreText.setString(score),personControl.yao(),score>cc.sys.localStorage.getItem("best_score")&&cc.sys.localStorage.setItem("best_score",score),preBlackXOffset=currBlackXOffset+40;var e=bgSize.width-betweenXOffset-40;gameViewXOffset+=e,this.runAction(cc.sequence(cc.moveBy(.3,cc.p(-e,0)),cc.callFunc(this.addBlock,this)))},gameFaile:function(){person.runAction(cc.sequence(cc.moveTo(.3,cc.p(person.getPositionX(),-200)),cc.callFunc(this.addGameFailView,this))),stickObject.runAction(cc.sequence(cc.rotateBy(.1,90)))},addGameFailView:function(){var e=new GameOver;e.x=gameViewXOffset,e.y=-100,this.addChild(e)},next:function(e){cc.log("fuck value is "+e);var t=e/500;personControl.walk(t/30),person.runAction(cc.sequence(cc.moveBy(t,cc.p(e,0)),cc.callFunc(this.nextBlack,this)))}}),MainScene=cc.Scene.extend({onEnter:function(){this._super();var e=cc.director.getWinSize(),t=cc.Sprite.create(res.img.main_restart);t.setPosition(e.width/2,e.height/2-200),t.setScale(.8),this.addChild(t,0);var t=cc.Sprite.create(res.img.main_arrow);t.setPosition(e.width/2,e.height/2),t.setScale(.8),this.addChild(t,0);var c=cc.LabelTTF.create("Hello World","Arial",40);c.setPosition(e.width/2,e.height/2+200),c.setColor(255,0,255),this.addChild(c,1)}}),menuViewLayer,gameView,gameViewBackground,MenuView=cc.Layer.extend({ctor:function(){this._super();var e=cc.winSize,t=new cc.MenuItemSprite(new cc.Sprite(res.img.main_start_normal),new cc.Sprite(res.img.main_start_select),this.onPlay,this),c=new cc.Menu(t);c.setPosition(e.width/2,e.height/2),this.addChild(c)},onPlay:function(){this.removeFromParent(!0),gameViewBackground.scoreBg(),gameViewBackground.drawGuideText(),gameView.startGame()}}),MenuViewScene=cc.Scene.extend({onEnter:function(){this._super(),gameViewBackground=new GameViewBackground,this.addChild(gameViewBackground,-1),menuViewLayer=new MenuView,this.addChild(menuViewLayer),gameView=new GameView,this.addChild(gameView,-1)}});cc.view.enableRetina(!1),cc.view.adjustViewPort(!0),cc.view.setDesignResolutionSize(params.width,params.height,cc.ResolutionPolicy.SHOW_ALL),cc.view.resizeWithBrowserSize(!0),cc.director.runScene(new MenuViewScene);}